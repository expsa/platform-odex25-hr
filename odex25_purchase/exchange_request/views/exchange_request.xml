<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- <record model="ir.actions.act_window" id="action_purchase_requisition_list">
            <field name="name">Request for Quotations</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.requisition</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('requisition_id','=',active_id)]</field>
            <field name="context">{"default_id":requisition_id}</field>
        </record> -->
        <!-- exchange requests form view -->
        <record model="ir.ui.view" id="exchange_request_form">
            <field name="name">exchange.request.form</field>
            <field name="model">exchange.request</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="action_submit" groups="base.group_user" states="draft" type="object"
                                string="Submit" class="oe_highlight"/>
                        <button name="action_confirm" groups="exchange_request.group_department_manager"
                                states="direct_manager" string="Confirm" type="object" class="oe_highlight"/>
                        <button name="action_sign" groups="stock.group_stock_user" states="confirm" string="Sign"
                                type="object" class="oe_highlight"/>
                        <button name="action_purchase_request_wizard" groups="stock.group_stock_user"
                                attrs="{'invisible':['|',('state','!=','confirm'),('requisition_type','!=','exchange')]}"
                                string="Create Purchase Request" type="object" class="oe_highlight"/>
                        <button name="action_exchange_wizard"
                                attrs="{'invisible':['|',('state','!=','sign'),('requisition_type','!=','exchange')]}"
                                string="Create Delivery" type="object" class="oe_highlight"
                                context="{'current_id':id}"/>
                        <button name="action_done"
                                attrs="{'invisible':['|',('state','!=','sign'),('requisition_type','!=','return')]}"
                                string="Create Delivery" type="object" class="oe_highlight"
                                context="{'current_id':id}"/>
                        <button name="action_cancel" groups="base.group_user" states="draft" string="Cancel"
                                type="object" class="oe_highlight"/>
                        <button name="action_cancel" groups="exchange_request.group_department_manager"
                                states="direct_manager" string="Cancel" type="object" class="oe_highlight"/>
                        <button name="action_cancel" groups="stock.group_stock_user" states="confirm" string="Cancel"
                                type="object" class="oe_highlight"/>
                        <button name="action_draft" states="cancel" string="Set to dratf" type="object"
                                class="oe_highlight"/>
                        <field name="state" widget="statusbar" attrs="{'invisible':[('requisition_type','=','return')]}"
                               statusbar_visible="draft,confirm,sign,done"/>
                    </header>
                    <sheet>
                        <div style="font-size:23pt;margin-left:10pt">
                            <field name="name" readonly="1"/>
                            <div class="oe_button_box" name="button_box">
                                <button name="action_purchase_request_list" type="object" class="oe_stat_button"
                                        icon="fa-list-alt"
                                        attrs="{'invisible':['|',('requisition_type','=','return'),('state','in',('draft','cancel','done'))]}">
                                    <field name="request_id_count" widget="statinfo" string="Purchase Request"/>
                                </button>
                            </div>
                            <button name="calculate" style="margin-left:520pt" icon="fa-gears" type="object"
                                    string="Check Availability" groups="stock.group_stock_user" class="btn-primary"
                                    attrs="{'invisible':['|',('requisition_type','=','return'),('state','in',('draft','direct_manager','cancel','done'))]}"/>
                        </div>

                        <group colspan="4" col="2">
                            <group>
                                <field name="other_employee" groups="exchange_request.request_for_other_emp"/>
                                <field name="request_date" required="1"
                                       attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))]}"/>
                                <field name="category_ids" required="1" widget="many2many_tags"
                                       attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))]}"/>
                                <field name="department_id" required="1" readonly="1"/>
                                <field name="purpose" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="purchase_type" invisible="1" string="Request Type" required="1"/>

                            </group>
                            <group>
                                <field name="employee_id" context="{'get_all' : other_employee }"
                                       attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))]}"
                                       required="1"/>
                                <field name="type" required="1"
                                       attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))]}"/>
                                <field name="stock_journal_id"
                                       attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))],'invisible' : ['|',('type' , '!=' , 'product'),('state' , 'in' , ['draft' , 'direct_manager'])],'required' : ['&amp;',('type' , '=' , 'product'),('state' , 'not in' , ['draft' , 'direct_manager','cancel'])]}"/>
                                <field name="warehouse_id"
                                       attrs="{'readonly':[('state','!=','confirm')],'invisible':['|',('state','in',('draft','direct_manager')),('type','=','service')],'required':['&amp;',('type','in',('product','custody')),('state','not in',('direct_manager','draft','cancel'))]}"/>
                                <field name="location_id" context="{'location':location_id}"
                                       attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))],'invisible':['|',('state','in',('draft','direct_manager')),('type','=','service')],'required':['&amp;',('type','in',('product','custody')),('state','not in',('direct_manager','draft','cancel'))]}"/>
                                <field name="return_exchange_id"
                                       options="{'no_create' : True , 'no_edit' : True ,'no_open' : True}"
                                       attrs="{'invisible':[('requisition_type','!=','return')],'required':[('requisition_type','=','return')],'readonly':[('state','!=','draft')]}"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Products">
                                <field name="line_ids"
                                       attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))]}">
                                    <tree editable="bottom">
                                        <field name="product_id"
                                               domain="[('type', '=', 'product'), ('consumed_ok', '=', True),
                                                         ('categ_id', 'child_of', parent.category_ids)]"
                                               attrs="{'readonly':[('parent.state','not in',('draft','confirm'))]}"
                                               context="{'product_exchange':parent.line_ids}" required="1"/>
                                        <field name="note"
                                               attrs="{'readonly':[('parent.state','not in',('draft','confirm'))]}"/>
                                        <field name="name" invisible="1"
                                               attrs="{'readonly':[('parent.state','not in',('draft','confirm'))]}"/>
                                        <field name="product_qty" required="1"
                                               attrs="{'readonly':[('parent.state','not in',('draft','confirm'))]}"/>
                                        <field name="Uom_id" domain="[('category_id','in',parent.category_ids)]"
                                               required="1"
                                               attrs="{'readonly':[('parent.state','not in',('draft','confirm'))]}"/>
                                        <field name="qty_available"
                                               attrs="{'column_invisible':['|',('parent.type','=','service'),('parent.requisition_type','=','return')]}"
                                               readonly="1" required="1"/>
                                    </tree>
                                </field>
                            </page>
                            <page string="Other Informations" groups="stock.group_stock_user">
                                <group>
                                    <group>
                                        <field name="picking_type_id"
                                               attrs="{'readonly':[('state','not in',('draft','confirm','direct_manager'))],'invisible':[('state','=','draft')],'required':[('warehouse_id','!=',False)]}"/>
                                        <field name="requisition_id"
                                               attrs="{'invisible':[('requisition_type','=','return')]}" readonly="1"/>
                                        <field name="reference" attrs="{'readonly':[('state','!=','draft')]}"/>
                                        <field name="requisition_type" readonly="1"/>
                                    </group>
                                    <group>
                                        <field name="user_id" required="1" readonly="1"/>
                                        <field name="company_id" required="1" readonly="1"/>
                                        <field name="partner_id" readonly="1"/>
                                    </group>
                                </group>
                            </page>
                            <page string="Stock Pickings">
                                <field name="stock_picking" readonly="1"/>

                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- exchange requests tree view -->
        <record model="ir.ui.view" id="view_exchange_request_tree">
            <field name="name">exchange.request.tree</field>
            <field name="model">exchange.request</field>
            <field name="arch" type="xml">
                <tree decoration-muted="state=='cancel'" decoration-success="state=='cancel'">
                    <field name="name"/>
                    <field name="department_id"/>
                    <field name="request_date"/>
                    <field name="category_ids"/>
                    <field name="location_id"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <!-- exchange requests action -->
        <record model="ir.actions.act_window" id="action_exchange_requests_mine">
            <field name="name">Exchange Requests</field>
            <!--            <field name="type">ir.actions.act_window</field>-->
            <field name="res_model">exchange.request</field>
            <!--            <field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_requisition_type':'exchange'}</field>
            <field name="domain">[('requisition_type','=','exchange'),('create_uid','=', uid)]</field>
        </record>

        <record model="ir.actions.act_window" id="action_exchange_requests_to_approve">
            <field name="name">Requests to Approve</field>
            <!--            <field name="type">ir.actions.act_window</field>-->
            <field name="res_model">exchange.request</field>
            <!--            <field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_requisition_type':'exchange','create' : False}</field>
            <field name="domain">[('state','!=','draft'),('requisition_type' , '=' , 'exchange')]</field>
        </record>

        <record model="ir.actions.act_window" id="action_exchange_requests_to_deliver">
            <field name="name">Requests to Deliver</field>
            <!--            <field name="type">ir.actions.act_window</field>-->
            <field name="res_model">exchange.request</field>
            <!--            <field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_requisition_type':'exchange'}</field>
            <field name="domain">[('state','not in',['draft','direct_manager']),('type' , '=' ,
                'product'),('requisition_type' , '=' , 'exchange')]
            </field>
        </record>

        <!-- exchange requests menu -->
        <menuitem id="exchange_requests_menu" name="Request for products and services"
                  web_icon="exchange_request,static/description/web_icon.png"/>

        <menuitem id="exchange_requests_mine" name="My Requests" parent="exchange_requests_menu"
                  action="action_exchange_requests_mine" sequence="1" groups="base.group_user"/>

        <menuitem id="exchange_requests_to_approve" name="Requests to Approve" parent="exchange_requests_menu"
                  action="action_exchange_requests_to_approve" sequence="2"
                  groups="exchange_request.group_department_manager"/>

        <menuitem id="exchange_requests_to_deliver" name="Requests to Deliver" parent="exchange_requests_menu"
                  action="action_exchange_requests_to_deliver" sequence="3" groups="stock.group_stock_user"/>

        <!-- return requests action -->
        <record model="ir.actions.act_window" id="action_return_requests">
            <field name="name">Return Requests</field>
            <!--            <field name="type">ir.actions.act_window</field>-->
            <field name="res_model">exchange.request</field>
            <!--            <field name="view_type">form</field>-->
            <field name="view_mode">tree,form</field>
            <field name="context">{'default_requisition_type':'return','default_type':'product'}</field>
            <field name="domain">[('requisition_type','=','return')]</field>
        </record>

        <!-- return requests menu -->
        <menuitem id="return_requests_menu" name="Return Requests" parent="stock.menu_stock_warehouse_mgmt"
                  action="action_return_requests" groups="stock.group_stock_manager,stock.group_stock_user"/>

        <!-- adding groups to existing menues -->
        <record model='ir.ui.menu' id='stock.product_product_menu'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_package'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_stock_inventory_control'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_reordering_rules_config'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_product_variant_config_stock'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_action_inventory_form'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_procurement_compute'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_action_production_lot_form'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_user','stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_routes_config'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_product_category_config_stock'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_attribute_action'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>
        </record>
        <!--        <record model='ir.ui.menu' id='stock.menu_variants_action'>-->
        <!--            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>-->
        <!--        </record>-->
        <record model='ir.ui.menu' id='stock.menu_product_packagings'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.product_uom_menu'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_stock_uom_categ_form_action'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>
        </record>
        <record model='ir.ui.menu' id='stock.menu_stock_uom_form_action'>
            <field name="groups_id" eval="[(4,ref('stock.group_stock_manager'))]"/>
        </record>
    </data>
</odoo>